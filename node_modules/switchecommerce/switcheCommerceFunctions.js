const fs = require("fs")
const axios = require("axios")
const tmp = require("tmp")

module.exports = {
    eCommerceDownloadFile: async function (downloadPath, downloadFileName, jobID) {
        var downloadFile = {
          method: "get",
          responseType: "stream",
          url: downloadPath,
          headers: {},
        };
        let tmpPath = tmp.fileSync({ prefix: "download_" });
        let result;
        await axios(downloadFile)
          .then(async function (response) {
            const myPromise = new Promise((resolve, reject) => {
              //console.log("respp=>>>>", response.data);
              try {
                let w = fs.createWriteStream(tmpPath.name);
                response.data.pipe(w);
                w.on("finish", function () {
                  result = { status: "succes", filePath: tmpPath.name, fileName: jobID + "_" + downloadFileName};
                  //console.log(result.filePath);
                  resolve(result);
                });
              } catch (error) {
                result = { status: "error", msg: error };
                reject(result);
              }
            });
    
            return await myPromise;
          })
          .catch(function (error) {
            console.log(error);
          });
        return result;
      },
}